var app={TIMELINE_VIEW:"timeline",SETTINGS_VIEW:"settings",DIRECT_MESSAGES_VIEW:"privateMessages",PUBLIC_KEYS_VIEW:"publicKeys",STATUS_MESSAGE_VIEW:"statusMessage",GUEST_VIEW:"guest",HASHES_VIEW:"hashes",oauthResult:null,doScroll:!0,activeUser:{},refreshActiveUserTotal(){if(app.activeUser){var a=app.getObject("privateKey-"+app.activeUser.user.id_str);app.activeUser.privateKey=a;a=app.getObject("publicKey-"+app.activeUser.user.id_str);app.activeUser.publicKey=a;a=app.getObject("publicKeys-"+app.activeUser.user.id_str);
app.activeUser.publicKeys=a;a=app.getObject("keyOptions-"+app.activeUser.user.id_str);app.activeUser.keyOptions=a;a=app.getObject("sentPublicKeys-"+app.activeUser.user.id_str);app.activeUser.sentPublicKeys=a;app.refreshActiveUserDMSenders()}},refreshActiveUserDMSenders(a){a=app.getObject("dmSenders-"+app.activeUser.user.id_str);app.activeUser.dmSenders=a},initialize(){location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search);app.unauthenticatedUI();app.initOauth()},
loginToTwitter(){OAuth.popup("twitter",{options:{cache:!0}}).done(function(a){app.oauthResult=a;app.saveOauth();app.updateOauthUserInfo()}).fail(function(a){alert("Error logging into Twitter.  Please try again");app.unauthenticatedUI()})},logoutFromTwitter(){app.oauthResult=null;app.lastProcessedStatusId=null;app.lastProcessedMessageId=null;app.dmMaxId=null;app.postedDirectMessageId=null;app.directMessagesToPost=null;app.directMessageCount=null;app.maxId=null;app.activeUser={};app.lastId=null;app.password=
null;app.postCompleteCount=0;app.postCompleteTarget=0;app.deleteSavedItem("user");localStorage.removeItem("oauth_token");localStorage.removeItem("oauth_token_secret");app.hideAllViews();app.unauthenticatedUI()},initOauth(){null==app.oauthResult&&OAuth.initialize(oauthio_key.key);app.loadOauth();app.updateOauthUserInfo()},saveOauth(){localStorage.setItem("oauth_token",app.oauthResult.oauth_token);localStorage.setItem("oauth_token_secret",app.oauthResult.oauth_token_secret)},loadOauth(){var a=localStorage.getItem("oauth_token"),
b=localStorage.getItem("oauth_token_secret");if(null==a||null==b)return null;app.oauthResult=OAuth.create("twitter",{oauth_token:a,oauth_token_secret:b})},updateOathUserInfoComplete(a){app.authenticatedHeader();null!=app.activeUser&&null!=app.activeUser.user&&null!=app.activeUser.user.id_str&&null==app.activeUser.privateKey?(app.hideAllViews(),$("#"+app.STATUS_MESSAGE_VIEW).show(),app.generatePrivateKeyPair(app.generatePassword(),!0,function(){app.updateUIBasedUponOauthResult()})):app.updateUIBasedUponOauthResult()},
updateOauthUserInfo(){null!=app.oauthResult?app.oauthResult.me().done(function(a){app.activeUser.user=a.raw;app.refreshActiveUserTotal();app.updateOathUserInfoComplete(a)}).fail(function(a){alert("There was an error logging you into Twitter.  Please reload the page and try again.")}):app.updateOathUserInfoComplete()},updateUIBasedUponOauthResult(){null!=app.oauthResult?(app.authenticatedUI(),app.maxId=null,app.updateHomeTimeline()):app.unauthenticatedUI()},dmMaxId:null,getDirectMessages(a){$("#directMessagesActionsContainer").empty();
$("#directMessagesBreadCrumbContainer").empty();a||$("#directMessages").empty();var b={count:200,full_text:!0};app.dmMaxId&&a&&(b.max_id=app.dmMaxId);$("#overlay").css("display","block");app.oauthResult.get("1.1/direct_messages.json",{data:b}).done(function(a){0<a.length?(app.processDirectMessagesResponse(a),app.updateDirectMesssagesBreadcrumbs(null),$("#overlay").css("display","none")):($("#overlay").css("display","none"),$("#directMessages").html("No direct messages via Seecret"))}).fail(function(a){$("#overlay").css("display",
"none")})},updateDirectMessagesUI(a){$("#getMessagesButton2").remove();var b=Handlebars.compile($("#direct-messages-template").html());$("#directMessages").append(b(a));$("#olderDirectMessagesButtonContainer").show()},publicKeyStartRegex:/^\s*-----BEGIN PGP PUBLIC KEY BLOCK-----\s/,publicKeyEndRegex:/\s-----END PGP PUBLIC KEY BLOCK-----\s*$/,pgpMessageStartRegex:/^\s*-----BEGIN PGP MESSAGE-----/,pgpMessageEndRegex:/\s-----END PGP MESSAGE-----\s*$/,isPublicKey(a){return app.publicKeyStartRegex.test(a)&&
app.publicKeyEndRegex.test(a)},isPGPMessage(a){return app.pgpMessageStartRegex.test(a)&&app.pgpMessageEndRegex.test(a)},timelineContainsKeys(a){for(var b in a)if(app.isPublicKey(a[b].seecret))return!0;return!1},timelineContainsEncryptedMessages(a){for(var b in a)if(app.isPGPMessage(a[b].seecret))return!0;return!1},getPublicKeyMessagesFromDMList(a){var b=[],c;for(c in a)app.isPublicKey(a[c].seecret)&&b.push(a[c]);return b},savePublicKeys(a){for(var b in a){var c=app.activeUser.publicKeys;null==c&&
(c={});var d={},e;for(e in a)a[e].sender.id_str!=app.activeUser.user.id&&(d[a[e].sender.id_str]||(d[a[e].sender.id_str]={key:a[e].seecret,screen_name:a[e].sender.screen_name,id_str:a[e].sender.id_str,receiveDate:a[e].created_at}));for(var f in d)c[f]=d[f];app.saveObject("publicKeys-"+app.activeUser.user.id_str,c);app.activeUser.publicKeys=c}},processDirectMessagesResponse(a){a=app.processDirectMessages(a,app.getUniqueDMSenders);for(var b in a)app.timelineContainsKeys(a)&&app.savePublicKeys(app.getPublicKeyMessagesFromDMList(a)),
app.timelineContainsEncryptedMessages(a)?(app.markEncryptedDirectMessages(a),app.decryptDirectMessages(a)):app.updateDirectMessagesUI(a)},markEncryptedDirectMessages(a){for(var b in a)this.isPGPMessage(a[b].seecret)&&(a[b].encrypted=!0,a[b].decrypted=!1)},sendPublicKeyMessages(a,b){app.postDirectMessages(a,function(){app.trackSentPublicKeys(b)})},trackSentPublicKeys(a){var b=app.activeUser.sentPublicKeys;null==b&&(b={});for(var c in a)b[c]=new Date;app.activeUser.sentPublicKeys=b;app.saveObject("sentPublicKeys-"+
app.activeUser.user.id_str,b)},passphrase:null,decryptDirectMessages(a){var b=openpgp.key.readArmored(app.activeUser.privateKey.armored).keys[0];app.decryptPrivateKey(b)?app.verifyMessagesDecrypted(a,b):app.updateDirectMessagesUI(a)},verifyMessagesDecrypted(a,b){var c=null,d;for(d in a)if(a[d].encrypted&&0==a[d].decrypted){c=d;break}var e=app.activeUser.user;if(null!=c)if(a[c].sender.id_str==e.id)a[c].decrypted=!0,app.verifyMessagesDecrypted(a,b);else{a[d].decrypted=!0;a[d].decryptionSuccessful=!1;
a[d].originaltext=a[d].text;try{var f=openpgp.message.readArmored(a[c].seecret),g={privateKey:b,message:f};if(app.activeUser.publicKeys&&app.activeUser.publicKeys[a[c].sender.id_str]){var l=openpgp.key.readArmored(app.activeUser.publicKeys[a[c].sender.id_str].key);g.publicKeys=l.keys}try{openpgp.decrypt(g).then(function(b){a[d].decryptionSuccessful=!0;a[d].seecret=b.data;b.signatures&&0<b.signatures.length&&b.signatures[0].valid&&(a[d].signed=!0);app.verifyMessagesDecrypted(a,g.privateKey)},function(b){a[d].text=
app.generateUndecryptedMessageContent(a[d]);app.verifyMessagesDecrypted(a,g.privateKey)})}catch(k){console.log("try/catch error decrypting: "+JSON.stringify(k)),a[d].text=app.generateUndecryptedMessageContent(a[d]),app.verifyMessagesDecrypted(a,b)}}catch(k){console.log("major try/catch error decrypting: "+JSON.stringify(k)),a[d].text=app.generateUndecryptedMessageContent(a[d]),app.verifyMessagesDecrypted(a,b)}}else{(c=app.activeUser.dmSenders)||(c={});for(var h in a)a[h].encrypted&&a[h].sender.id_str!=
app.activeUser.id&&(c[a[h].sender.id_str]=!0);app.saveObject("dmSenders-"+app.activeUser.user.id_str,c);app.refreshActiveUserDMSenders();app.updateDirectMessagesUI(a)}},undecryptedMessageContentHandler:null,generateUndecryptedMessageContent(a){app.undecryptedMessageContentHandler||(app.undecryptedMessageContentHandler=Handlebars.compile($("#undecrypted-message-content-template").html()));return app.undecryptedMessageContentHandler(a)},showPublicKeyManager(a,b){app.doScroll=!1;var c={};c.receiver_name=
b;c.receiver_id=a;c=Handlebars.compile($("#public-key-template").html())(c);$("#directMessagesActionsContainer").html(c)},showWaitingForPublicKeyView(a,b){app.doScroll=!1;var c={};c.receiver_name=b;c.receiver_id=a;c.invite_date=moment(app.activeUser.sentPublicKeys[a]).format("MMMM Do YYYY, h:mm:ss a");c=Handlebars.compile($("#public-key-pending-template").html())(c);$("#directMessagesActionsContainer").html(c)},showDirectMessageForm(a,b){app.doScroll=!1;var c={receiverId:a,receiverName:b},d=Handlebars.compile($("#direct-message-template").html());
$("#directMessagesActionsContainer").html(d(c));app.doScroll=!1},makeKeyOptionsForUser(a){var b=app.generatePassword();return{numBits:1024,userIds:[{name:a.name,email:a.screen_name+"@seecretApp.seecret"}],passphrase:b}},generatePassword(){for(var a="",b=0;50>b;b++){var c=Math.floor(96*Math.random())+31;92==c||34==c||39==c||36==c?b--:a+=String.fromCharCode(c)}return a},validateNewPrivateKey(a){if(1>$("#"+a).val().length)return $("#"+a+"Error").html("You must have a passphrase for your key of at least one character"),
!1;$("#"+a+"Error").html("");if(confirm("Are you sure?")){var b=$("#"+a).val(),c=1==document.getElementById(a+"Cache").checked;app.hideAllViews();$("#"+app.STATUS_MESSAGE_VIEW).show();app.generatePrivateKeyPair(b,c,function(){$("#"+a).val("");app.setView(app.DIRECT_MESSAGES_VIEW);confirm("Send your new key to the contacts who have the old one?")&&app.resendPublicKeys();$("#directMessagesActionsContainer").empty()})}},resendPublicKeys(){var a=app.activeUser.sentPublicKeys,b=app.activeUser.dmSenders;
if(null!=a||null!=b){var c=[],d={},e;for(e in a)d[e]=!0;for(e in b)d[e]=!0;var a=0,f;for(f in d){a++;var b=app.generatePublicKeyMessages(f),g;for(g in b)c.push({receiverId:f,text:b[g]})}0<c.length&&app.sendPublicKeyMessages(c,d)}},generatePrivateKeyPair(a,b,c){var d=app.activeUser.user,e=app.makeKeyOptionsForUser(d);e.passphrase=a;d.id_str||(e.userId=d.id_str);null!=d&&openpgp.generateKey(e).then(function(a){app.generatePrivateKeyPairSuccess(a,e,b,c)})},generatePrivateKeyPairSuccess(a,b,c,d){c||delete b.passphrase;
c=app.activeUser.user;var e=new Date,f={};f.armored=a.privateKeyArmored;f.dateCreated=e;var g={};g.armored=a.publicKeyArmored;g.dateCreated=e;app.saveObject("keyOptions-"+c.id_str,b);app.saveObject("privateKey-"+c.id_str,f);app.saveObject("publicKey-"+c.id_str,g);app.checkDirectMessageStatus();app.refreshActiveUserTotal();d()},setDirectMessageReceiver(a,b){$("#selectedReceiverId").val(a);$("#selectedReceiverName").val(b);var c={};c.name=b;c.id_str=a;var d=app.activeUser.publicKeys,e;for(e in d)d[e].id_str==
a&&(c.publicKey=d[e],c.publicKey.displayDate=(new moment(c.publicKey.receiveDate)).format("MMMM Do YYYY, h:mm:ss a"));app.updateDirectMesssagesBreadcrumbs(c);app.checkDirectMessageStatus();$(".dmMessageDiv").hide();$(".dm_"+a).fadeIn()},showAllDirectMessages(){$(".dmMessageDiv").show();app.updateDirectMesssagesBreadcrumbs();$("#directMessagesActionsContainer").html("")},updateDirectMesssagesBreadcrumbs(a){var b=Handlebars.compile($("#direct-message-breadcrumb-template").html());$("#directMessagesBreadCrumbContainer").html(b(a))},
initiateDirectMessages(a,b){var c=app.generatePublicKeyMessages(a),d=[],e;for(e in c)d.push({receiverId:a,text:c[e]});b||d.push({text:app.joinMessage2,receiverId:a});app.postDirectMessages(d,function(){var c={};c[a]=!0;app.trackSentPublicKeys(c);app.checkDirectMessageStatus();b&&alert("Sent!")})},joinMessage2:"I'm using Seecret to send encrypted direct messages over Twitter. Try it with me! Just go to https://www.seecret.net",prepareDirectMessage(a){var b=$("#directMessage").val();app.encryptDirectMessage(b,
a)},decryptPrivateKey(a){var b=app.activeUser.keyOptions,c=null;app.passphrase&&(c=app.passphrase);b.passphrase&&(c=b.passphrase);b.passphrase||null!=app.passphrase||(app.passphrase=c=prompt("Enter your passphrase"));return a.decrypt(c)},encryptDirectMessage(a,b){var c=app.activeUser.publicKeys,d=null,e;for(e in c)e==b&&(d=c[e].key);d&&(c=openpgp.key.readArmored(d).keys,c={publicKeys:c,data:a},app.activeUser.privateKey&&(d=openpgp.key.readArmored(app.activeUser.privateKey.armored),app.decryptPrivateKey(d.keys[0])&&
(c.privateKeys=d.keys)),openpgp.encrypt(c).then(function(a){a=app.hideAndCompress(a.data);app.seecret_engine.config.RANDOM_COVERTEXTS=!0;app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=1E4;a=app.seecret_engine.chainify(a,covertexts);app.seecret_engine.config.RANDOM_COVERTEXTS=!1;app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=140;a.reverse();for(var c in a)a[c]={receiverId:b,text:a[c]};app.postDirectMessages(a,function(){});$("#directMessage").val("")}).catch(function(a){console.log("Error generating the messages:"+
JSON.stringify(a))}))},postedDirectMessageId:null,directMessagesToPost:null,directMessageCount:0,postDirectMessages(a,b){app.directMessagesToPost=a;app.directMessageCount=0;app.checkDirectMessages(b)},checkDirectMessages(a){if(app.directMessagesToPost&&app.directMessageCount<app.directMessagesToPost.length){var b=app.directMessagesToPost[app.directMessageCount].text,c=app.directMessagesToPost[app.directMessageCount].receiverId;app.directMessageCount++;app.postDirectMessage(b,c,a)}else a&&a()},postDirectMessage(a,
b,c){app.oauthResult.post("1.1/direct_messages/new.json",{data:{text:a,user_id:b}}).done(function(a){app.checkDirectMessages(c)}).fail(function(a){})},generatePublicKeyMessages(a){a=app.activeUser.publicKey;if(null!=a)return a=app.hideAndCompress(a.armored),app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=1E4,chain=app.seecret_engine.chainify(a,["Here's my Seecret key","Now we can start using Seecret to send encrypted messages on Twitter."]),chain.reverse(),app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=
140,chain},promptDeleteKey(){confirm("Are you sure?")&&(app.deleteSavedItem("privateKey-"+app.activeUser.user.id_str),app.deleteSavedItem("publicKey-"+app.activeUser.user.id_str),app.deleteSavedItem("keyOptions-"+app.activeUser.user.id_str),app.activeUser.privateKey=null,app.activeUser.publicKey=null,app.activeUser.keyOptions=null,app.renderPrivateKeySettings(),app.setView(app.SETTINGS_VIEW))},checkDirectMessageStatus(){app.doScroll=!1;var a=$("#selectedReceiverId").val(),b=$("#selectedReceiverName").val();
if(a)if(null==app.activeUser.privateKey)app.showPrivateKeyManager();else{var c=app.activeUser.publicKeys,d=app.activeUser.sentPublicKeys;null==d||null==d[a]||null!=c&&c[a]?null==c||null!=c&&!c[a]?app.showPublicKeyManager(a,b):app.showDirectMessageForm(a,b):app.showWaitingForPublicKeyView(a,b);app.doScroll=!0}},maxId:null,lastId:null,homeTimeline:!0,userTimelineId:null,updateUserTimeline(a,b){b&&(app.maxId=null);app.userTimelineId=a;app.homeTimeline=!1;app.updatingTimeline=!0;var c={data:{}};c.data.count=
200;c.data.screen_name=a;c.data.include_rts=!1;null!=app.maxId?c.data.max_id=app.maxId:$("#status-list").empty();$("#overlay").css("display","block");app.getUserTimeline(c,app.handleTimelineResponse)},getTimeline(a,b){app.oauthResult.get("1.1/statuses/home_timeline.json",a).done(function(a){b(a);$("#overlay").css("display","none")}).fail(app.handleGetTimelineError)},getUserTimeline(a,b){app.oauthResult.get("1.1/statuses/user_timeline.json",a).done(function(a){b(a);$("#overlay").css("display","none")}).fail(app.handleGetTimelineError)},
handleTimelineResponse(a){0<a.length?app.processTimelineResponse(a):app.handleEmptyTimelineResponse(a)},handleGetTimelineError(){alert("There was an error retrieving your timeline.");$("#overlay").css("display","none")},handleEmptyTimelineResponse(a){$("#overlay").css("display","none")},processTimelineResponse(a){app.addFollowerTagToTweets(a,app.processTimelineWithFollowerInfo)},addFollowerTagToTweets(a,b){var c={},d;for(d in a)c[a[d].user.id_str]=a[d].user.id_str;d=[];for(var e in c)d.push(e);c=
{data:{}};c.data.user_id=d.join();app.oauthResult.get("1.1/friendships/lookup.json",c).done(function(c){var d={},e;for(e in c)0<=c[e].connections.indexOf("followed_by")&&(d[c[e].id_str]=!0);for(var h in a)d[a[h].user.id_str]&&(a[h].follower=!0);b(a)}).fail(function(c){b(a)})},unhideAndDecompressTimelineSeecrets(a,b){b=void 0===b?!1:b;var c=[],d;for(d in a)if(a[d].seecret_envelope){var e=a[d].seecret_envelope,f=app.seecret_engine.getSeecretFromEnvelope(e),e=app.seecret_engine.getContentTypeFromEnvelope(e),
f=app.seecret_engine.unhide(f,e);if(e==app.seecret_engine.config.CONTENT_TYPES.NUMBERS_ARRAY)try{f=seecret_compression.decompress(f),a[d].seecret=f}catch(g){a[d].seecret="Could not decompress the Seecret",a[d].seecret_error=g}else a[d].seecret=f;c.push(a[d])}else b&&!app.seecret_engine.hasSeecretContent(a[d].text)&&c.push(a[d]);return c},getEarliestIncompleteChainStartId(a,b){for(var c in b)app.getFirstIncompleteChainStart(a,b[c])},getEarliestIncompleteDMChainStartId(a,b){for(var c in b)app.getFirstIncompleteDMChainStart(a,
b[c])},getFirstIncompleteChainStart(a,b){var c=0,d;for(d in a)a[d].user.id_str==b&&app.seecret_engine.hasSeecretContent(a[d].text)&&(app.seecret_engine.isEnvelopeStart(a[d].text)&&(c=d),app.seecret_engine.isEnvelopeEnd(a[d].text)&&(c=0));return c},getFirstIncompleteDMChainStart(a,b){var c=0,d;for(d in a)a[d].sender.id_str==b&&app.seecret_engine.hasSeecretContent(a[d].text)&&(app.seecret_engine.isEnvelopeStart(a[d].text)&&(c=d),app.seecret_engine.isEnvelopeEnd(a[d].text)&&(c=0));return c},processDirectMessages(a,
b){var c=b(a),d=app.getSeecretMessageIndexesBySender(a,c);a=app.dechainifyDirectMessages(a,d);app.dmMaxId=app.lastProcessedStatusId=a[a.length-1].id_str;c=app.getEarliestIncompleteDMChainStartId(a,c);0<c&&(app.dmMaxId=a[c].id_str);return a=app.unhideAndDecompressTimelineSeecrets(a,!0)},processTimelineMessages(a,b){var c=b(a),d=app.getMessageIndexes(a,c,app.tweetSenderGetter);a=app.dechainifyTweets(a,d);app.maxId=app.lastProcessedStatusId=a[a.length-1].id_str;c=app.getEarliestIncompleteChainStartId(a,
c);0<c&&(app.maxId=a[c].id_str);return a=app.unhideAndDecompressTimelineSeecrets(a)},processTimelineWithFollowerInfo(a){a=app.processTimelineMessages(a,app.getUniqueTweeters);var b=Handlebars.compile($("#status-template").html());$("#status-list").append(b(a));$(".basicTweet").fadeIn();app.updatingTimeline=!1;app.userTimelineId?app.renderUserTimelineHeader(app.userTimelineId):$("#timelineName").html("")},renderUserTimelineHeader(a){$("#timelineName").html("for "+a+" &nbsp;&nbsp;&nbsp;<a href='javascript:app.initTimeline();app.updateHomeTimeline()'>Back to my timeline</a>")},
dechainifyTweets(a,b){for(var c in b)if(0<b[c].length){var d=0,e;for(e in b[c]){var f=app.seecret_engine.dechainifyWithCovertexts(a,{chainSegmentMatcher(a){return a&&a.text&&"string"==typeof a.text&&a.user&&a.user.id_str==c?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder,ordinal:d});f&&""!=f.seecret&&(a[b[c][e]].seecret_envelope=f.seecret,a[b[c][e]].covertexts=f.covertexts);d++}}return a},dechainifyDirectMessages(a,b){for(var c in b)if(0<b[c].length){var d=0,e;for(e in b[c]){var f=
app.seecret_engine.dechainifyWithCovertexts(a,{chainSegmentMatcher(a){return a&&a.text&&"string"==typeof a.text&&a.sender&&a.sender.id_str==c?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder,ordinal:d});f&&""!=f.seecret&&(a[b[c][e]].seecret_envelope=f.seecret,a[b[c][e]].covertexts=f.covertexts);d++}}return a},chainSegmentContentFinder(a){return a.text},tweetSenderGetter(a){return a.user?a.user.id_str:null},dmSenderGetter(a){return a.user?a.user.id_str:null},getMessageIndexes(a,b,c){var d=
{},e;for(e in b)d[e]=app.seecret_engine.getOrdinalIndexes(a,{chainSegmentMatcher(a){return c(a)==b[e]?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder});return d},getSeecretMessageIndexesByUser(a,b){var c={},d;for(d in b)c[d]=app.seecret_engine.getOrdinalIndexes(a,{chainSegmentMatcher(a){return a&&a.text&&"string"==typeof a.text&&a.user&&a.user.id_str==b[d]?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder});return c},getSeecretMessageIndexesBySender(a,b){var c={},d;
for(d in b)c[d]=app.seecret_engine.getOrdinalIndexes(a,{chainSegmentMatcher(a){return a&&a.text&&"string"==typeof a.text&&a.sender&&a.sender.id_str==b[d]?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder});return c},getUniqueTweeters(a){return app.getUniqueInstancesFromList(a,app.getTweeterId)},getUniqueDMSenders(a){return app.getUniqueInstancesFromList(a,app.getDMSenderId)},getTweeterId(a){return a.user.id_str},getDMSenderId(a){return a.sender.id_str},getUniqueInstancesFromList(a,
b){var c={},d;for(d in a){var e=b(a[d]);c[e]=e}return c},generateTimelinePostVals(){var a={data:{}};a.data.count=200;null!=app.maxId&&(a.data.max_id=app.maxId);return a},initTimeline(){app.maxId=null;app.homeTimeline=!0;app.userTimelineId=null;app.updateHomeTimeline()},updateHomeTimeline(){app.homeTimeline=!0;$("#timelineName").empty();app.updatingTimeline=!0;var a=app.generateTimelinePostVals();a.maxId||($("#status-list").empty(),app.lastProcessedStatusId=null);$("#overlay").css("display","block");
app.getTimeline(a,app.handleTimelineResponse)},postCompleteCount:0,postCompleteTarget:0,prepareUpdateMessage(){var a=$("#textarea-statusUpdate").val(),a=app.hideAndCompress(a),b=null;app.useAutogeneratedScaffolding()||(b=app.getScaffolds());a=app.seecret_engine.chainify(a,b);a.reverse();return a},updateStatus(){var a=this.prepareUpdateMessage();this.postChain(a)},postChain(a){this.currentMessageChain=a;this.chainCount=0;this.postChainItem()},postChainItem(){if(this.chainCount<this.currentMessageChain.length)app.oauthResult.post("1.1/statuses/update.json",
{data:{status:this.currentMessageChain[this.chainCount++]}}).done(function(a){setTimeout(function(){app.postChainItem()},50)}).fail(function(a){});else{$("#status-list").empty();$("#scaffoldingWarningContainer").empty();$("#scaffoldingStatus").empty();$("#textarea-statusUpdate").val("");$("#textarea-statusUpdate").val("");var a=Handlebars.compile($("#scaffolds-template").html());$("#scaffoldsContainer").html(a());$("#scaffoldingContainer > div > div > input").val("");app.maxId=null;this.currentMessageChain=
[];this.chainCount=0;app.updateHomeTimeline();app.setView(app.TIMELINE_VIEW)}},authenticatedUI(){app.authenticatedHeader();app.authenticatedMenu();app.setView(app.TIMELINE_VIEW)},unauthenticatedUI(){$("#status-list").empty();$("#userLabel").empty();$("#userProfileImg").hide();$("#directMessages").empty();$("#publicKeys").empty();$("#directMessagesActionsContainer").val("");$("#textarea-statusUpdate").val("");$("#importPrivateKeyText").val("");$("#importPrivateKeyPassphrase").val("");$("#privateKeyTextarea").val("");
$("#privateKeyPassphrase").val("");$("#privateKeyCopyarea").empty();$("#publicKeysDisplayArea").empty();app.unauthenticatedHeader();app.hideAllViews();$("#privateMessageButton").hide();$("#timelineButton").hide();app.unauthenticatedMenu();app.setView(app.GUEST_VIEW)},authenticatedMenu(){$("#privateMessageButton").show();$("#timelineButton").show();$("#settingsButton").show();$("#logoutButton").show();$("#hashesButton").show();$("#publicKeysButton").show()},unauthenticatedMenu(){$("#privateMessageButton").hide();
$("#timelineButton").hide();$("#settingsButton").hide();$("#logoutButton").hide();$("#publicKeysButton").hide()},authenticatedHeader(){var a=Handlebars.compile($("#authenticated-header-template").html());$("#loginContainer").html(a(app.activeUser.user))},unauthenticatedHeader(){var a=Handlebars.compile($("#unauthenticated-header-template").html());$("#loginContainer").html(a())},hideAllViews(){$("#timeline").hide();$("#statusMessage").hide();$("#privateMessages").hide();$("#settings").hide();$("#publicKeys").hide();
$("#guest").hide();$("#hashes").hide()},setMenuState(a){$.each($(".menuLink"),function(a,c){$(this).css("background","");$(this).css("color","")});$("#"+a).css("background","#e3e3e3");$("#"+a).css("color","#333");app.openClosePanel("close")},setView(a){app.doScroll=!1;app.hideAllViews();$("#"+a).fadeIn(function(){app.doScroll=!0});app.setMenuState(a+"Button")},renderPublicKeys(){var a=Handlebars.compile($("#public-keys-template").html()),b=app.activeUser.publicKeys,c=[],d=0,e;for(e in b)b[e].displayDate=
moment(b[e].receiveDate).format("MMMM Do YYYY, h:mm:ss a"),c.push(b[e]),d++;0<d?(a=a({keys:c}),$("#publicKeysDisplayArea").html(a)):$("#publicKeysDisplayArea").html("No public keys")},copySenderPublicKeyToClipboard(a){var b=app.activeUser.publicKeys;b[a]&&(executeCopy(b[a].key),alert(b[a].screen_name+"'s key has been copied to your clipboard"))},copyContentsToClipboard(a){executeCopy($("#"+a).html())},showPrivateKeyManager(){app.doScroll=!1;var a=Handlebars.compile($("#private-key-template").html());
$("#directMessagesActionsContainer").html(a());$("#directMessagesActionsContainer").show()},openClosePanel(a){"open"==a?$("#left-panel").css("left",0):$("#left-panel").css("left","-14em")},processScaffoldField(a){a=$("#scaffold"+a);val=a.val();for(var b=val.replace(/\s{2,}/g," ");" "==b.substr(0,1);)b=b.substr(1);b=b.substr(0,100);b!=val&&a.val(b)},useAutogeneratedScaffolding(){return!1},hideAndCompress(a){var b=app.seecret_engine.hide(a,app.seecret_engine.config.CONTENT_TYPES.PLAIN),b=app.seecret_engine.envelope(b,
app.seecret_engine.config.CONTENT_TYPES.PLAIN);a=seecret_compression.compress(a);a=app.seecret_engine.hide(a,app.seecret_engine.config.CONTENT_TYPES.NUMBERS_ARRAY);a=app.seecret_engine.envelope(a,app.seecret_engine.config.CONTENT_TYPES.NUMBERS_ARRAY);return b.length>a.length?a:b},processScaffolding(){var a=$("#textarea-statusUpdate").val();if(!app.useAutogeneratedScaffolding()){var b=!1,a=app.hideAndCompress(a),c=app.getScaffolds(),d=0,e=0;if(1==c.length)if(2<=c[0].trim().length&&c[0].trim().length+
a.length<app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH)b=!0,d=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH-a.length-c[0].trim().length;else{if(2>c[0].trim().length){app.makeUpdateFormPending();return}e=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH-(c[0].trim().length+a.length);e*=-1}else{var f=scaffoldLength=0;for(each in c)2<=c[each].trim().length&&(scaffoldLength+=c[each].trim().length,f++);scaffoldLength+a.length<app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH*f?(b=!0,d=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH*
f-(scaffoldLength+a.length)):(e=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH*f-(scaffoldLength+a.length),e*=-1)}b?app.makeUpdateFormReady(d):app.makeUpdateFormNotReady(e)}},newVisibleMessageField(){var a=app.getScaffolds();app.addScaffoldField(a.length);app.processScaffolding()},addScaffoldField(a,b){var c={scaffoldId:a,val:b,scaffoldCount:a+1},d=Handlebars.compile($("#scaffold-template").html());$("#scaffoldsContainer").append(d(c))},makeUpdateFormReady(a){$("#submitButtonContainer").show();
var b=Handlebars.compile($("#scaffold-status-good-template").html()),c={};c.availableCharacters=a;$("#scaffoldingStatus").html(b(c))},makeUpdateFormNotReady(a){$("#submitButtonContainer").hide();var b=Handlebars.compile($("#scaffold-status-spillover-template").html()),c={};c.spillover=a;$("#scaffoldingStatus").html(b(c))},makeUpdateFormPending(){$("#submitButtonContainer").hide();var a=Handlebars.compile($("#scaffold-status-incomplete-template").html());$("#scaffoldingStatus").html(a())},removeScaffold(a){var b=
app.getScaffolds(),c=[],d;for(d in b)d!=a&&c.push(b[d]);app.renderScaffolds(c);app.processScaffolding()},renderScaffolds(a){$("#scaffoldsContainer").html("");for(var b=0,c=0;c<a.length;c++)app.addScaffoldField(b++,a[c]);$("#scaffoldRemover0").remove()},getScaffolds(){for(var a=[],b=document.getElementById("scaffold0");b;)a.push(b.value.trim()),b=document.getElementById("scaffold"+a.length);return a},toggleScaffolds(){document.getElementById("scaffoldingOption").checked?($("#scaffoldingStatus").html(""),
$("#scaffoldsContainer").html(""),$("#scaffoldingWarningContainer").hide(),$("#scaffoldingContainer").hide(),$("#submitButtonContainer").show()):($("#scaffoldingStatus").html(""),$("#scaffoldsContainer").html(""),$("#scaffoldingContainer").show(),$("#scaffoldingWarningContainer").html(""),$("#submitButtonContainer").hide(),app.addScaffoldField(0),app.processScaffolding())},getScaffoldTotal(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].trim().length;return b},showCopyPrivateKey(a){"block"==$("#privateKeyCopyarea").css("display")?
($(a).html("Show"),$("#privateKeyCopyarea").hide(),$("#privateKeyCopyarea").html("")):($(a).html("Hide"),app.renderPrivateKeySettings())},toggleDeleteSettings(a){"block"==$("#deleteKeyForm").css("display")?($(a).html("Show"),$("#deleteKeyForm").hide()):($(a).html("Hide"),$("#deleteKeyForm").show())},renderPrivateKeySettings(){var a=app.activeUser.publicKey,b=app.activeUser.keyOptions,c={};c.privateKey=app.activeUser.privateKey;c.privateKey.dateCreatedDisplay=(new moment(c.privateKey.dateCreated)).format("MMMM Do YYYY, h:mm:ss a");
c.publicKey=a;c.keyOptions=b;a=Handlebars.compile($("#user-keys-template").html())(c);$("#privateKeyCopyarea").html(a);$("#privateKeyCopyarea").fadeIn()},showPublicKeys(a){"block"==$("#publicKeysDisplayArea").css("display")?($(a).html("Show"),$("#publicKeysDisplayArea").hide()):($(a).html("Hide"),app.renderPublicKeys(),$("#publicKeysDisplayArea").fadeIn())},showImportPrivateKey(a){"block"==$("#importForm").css("display")?($(a).html("Show"),$("#importForm").hide()):($(a).html("Hide"),$("#importForm").show())},
showGeneratePrivateKey(a){"block"==$("#generateForm").css("display")?($(a).html("Show"),$("#generateForm").hide()):($(a).html("Hide"),$("#generateForm").show())},saveObject(a,b){localStorage[a]=JSON.stringify(b)},getObject(a){return app.getLocalObject(a)},getLocalObject(a){return localStorage[a]?JSON.parse(localStorage[a]):null},saveLocalObject(a,b){localStorage[a]=JSON.stringify(b)},deleteSavedItem(a){delete localStorage[a]},privateKeyUpdateStatus:{},importPrivateKey(){var a=app.activeUser.user,
b=$("#importPrivateKeyText").val(),c=new Date,d=openpgp.key.readArmored(b);if(!d||!d.keys||1>d.keys.length)alert("The key is invalid");else{var e=openpgp.key.readArmored(b).keys[0],f=$("#importPrivateKeyPassphrase").val();e.decrypt(f)?(f=$("#importPrivateKeyPassphrase").val(),$("#importPrivateKeyText").val(""),$("#importPrivateKeyPassphrase").val(""),d=app.makeKeyOptionsForUser(a),d.passphrase=f,b={armored:b,dateCreated:c},c={armored:e.toPublic().armor(),dateCreated:c},app.activeUser.privateKey=b,
app.activeUser.publicKey=c,app.activeUser.keyOptions=d,app.saveObject("privateKey-"+a.id_str,b),app.saveObject("publicKey-"+a.id_str,c),app.saveObject("keyOptions-"+a.id_str,d),app.activeUser.privateKey=b,app.activeUser.publicKey=c,app.activeUser.keyOptions=d,app.resendPublicKeys(),app.renderPrivateKeySettings(),alert("Successfully imported the private key.")):alert("Could not decrypt the key with the passphrase you entered.  Please try again")}},deleteSavedPassphrase(){if(confirm("Are you sure?")){var a=
app.activeUser.user,b=app.activeUser.keyOptions;b.passphrase="";app.activeUser.keyOptions=b;app.saveObject("keyOptions-"+a.id_str,b)}app.renderPrivateKeySettings()},changePassphrase(){var a=prompt("Enter new passphrase");if(null!=a){var b=prompt("Enter it again");null!=b&&(a==b?(alert("Changing your passphrase to "+b+"\n we urge you to delete it from this device once you've got it memorized or saved elsewhere."),app.setNewPassphraseOnPrivateKey(a)):alert("Your new passphrase did not match, please try again"))}app.renderPrivateKeySettings()},
setNewPassphraseOnPrivateKey(a){var b=app.activeUser.user,c=app.activeUser.keyOptions,d=openpgp.key.readArmored(app.activeUser.privateKey.armored);if(app.decryptPrivateKey(d.keys[0])){d.keys[0].primaryKey.encrypt(a);d.keys[0].subKeys&&0<d.keys[0].subKeys.length&&d.keys[0].subKeys[0]&&d.keys[0].subKeys[0].subKey.encrypt(a);var e={};e.dateCreated=new Date;e.armored=d.keys[0].armor();var f={};f.dateCreated=new Date;f.armored=d.keys[0].toPublic().armor();c.passphrase=a;app.saveObject("publicKey-"+b.id_str,
f);app.saveObject("privateKey-"+b.id_str,e);app.saveObject("keyOptions-"+b.id_str,c);app.activeUser.publicKey=f;app.activeUser.privateKey=e;app.activeUser.keyOptions=c}else alert("Old passphrase was incorrect.  Please try again");app.renderPrivateKeySettings()},privateKeyTest(){var a=openpgp.key.readArmored(app.activeUser.privateKey.armored).keys[0];alert(app.decryptPrivateKey(a))}};$("#updateStatusForm").submit(function(a){a.preventDefault();app.updateStatus()});
$(document).ready(function(){openpgp.config.show_comment=!1;openpgp.config.show_version=!1;app.initialize();app.seecret_engine=new SEECRET_ENGINE;$(window).scroll(function(){if(app.doScroll){var a=$(window).scrollTop(),c=$(window).height(),d=$(document).height();a+c==d&&("block"!=document.getElementById("timeline").style.display||app.updatingTimeline?"block"!=document.getElementById("privateMessages").style.display||app.updatingDirectMessages||app.getDirectMessages(!0):app.homeTimeline?app.updateHomeTimeline():
app.updateUserTimeline(app.userTimelineId))}});$("#textarea-statusUpdate").keyup(function(a){app.processScaffolding()});$("#textarea-statusUpdate").change(function(a){app.processScaffolding()});$("#scaffoldingEntryContainer0").keyup(function(a){app.processScaffoldField(0);app.processScaffolding()});var a=Handlebars.compile($("#hashes-template").html())(seecret_hashes);$("#hashesContent").html(a)});
Handlebars.registerHelper("tweetShortDate",function(a){a=moment(a,"dd MMM DD HH:mm:ss ZZ YYYY","en").twitter();a.match(/\//)||(a+=" ago");return a});window.onhashchange=function(){var a=(new URI(location.href)).fragment();a||document.location.reload(!0);app.setView(a)};
function executeCopy(a){var b=document.createElement("div");b.contentEditable=!0;document.body.appendChild(b);b.innerHTML=a.replace(/\n/g,"<br/>");b.unselectable="off";b.focus();document.execCommand("SelectAll");document.execCommand("Copy",!1,null);document.body.removeChild(b)};
