var app={TIMELINE_VIEW:"timeline",SETTINGS_VIEW:"settings",DIRECT_MESSAGES_VIEW:"privateMessages",PUBLIC_KEYS_VIEW:"publicKeys",STATUS_MESSAGE_VIEW:"statusMessage",ABOUT_VIEW:"about",HASHES_VIEW:"hashes",oauthResult:null,doScroll:!0,activeUser:{},refreshActiveUserTotal:function(){if(app.activeUser){var a=app.getObject("privateKey-"+app.activeUser.user.id_str);app.activeUser.privateKey=a;a=app.getObject("publicKey-"+app.activeUser.user.id_str);app.activeUser.publicKey=a;a=app.getObject("publicKeys-"+
app.activeUser.user.id_str);app.activeUser.publicKeys=a;a=app.getObject("keyOptions-"+app.activeUser.user.id_str);app.activeUser.keyOptions=a;a=app.getObject("sentPublicKeys-"+app.activeUser.user.id_str);app.activeUser.sentPublicKeys=a;app.refreshActiveUserDMSenders()}},refreshActiveUserDMSenders:function(a){a=app.getObject("dmSenders-"+app.activeUser.user.id_str);app.activeUser.dmSenders=a},initialize:function(){location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search);
app.unauthenticatedUI();app.initOauth()},loginToTwitter:function(){OAuth.popup("twitter",{options:{cache:!0}}).done(function(a){console.log("oauth done!");app.oauthResult=a;app.saveOauth();app.updateOauthUserInfo()}).fail(function(a){console.log(JSON.stringify(a));alert("Error logging into Twitter.  Please try again");app.unauthenticatedUI()})},logoutFromTwitter:function(){app.oauthResult=null;app.lastProcessedStatusId=null;app.lastProcessedMessageId=null;app.dmMaxId=null;app.postedDirectMessageId=
null;app.directMessagesToPost=null;app.directMessageCount=null;app.maxId=null;app.activeUser={};app.lastId=null;app.password=null;app.postCompleteCount=0;app.postCompleteTarget=0;app.deleteSavedItem("user");localStorage.removeItem("oauth_token");localStorage.removeItem("oauth_token_secret");app.hideAllViews();app.unauthenticatedUI()},initOauth:function(){null==app.oauthResult&&OAuth.initialize(oauthio_key.key);app.loadOauth();app.updateOauthUserInfo()},saveOauth:function(){localStorage.setItem("oauth_token",
app.oauthResult.oauth_token);localStorage.setItem("oauth_token_secret",app.oauthResult.oauth_token_secret)},loadOauth:function(){var a=localStorage.getItem("oauth_token"),b=localStorage.getItem("oauth_token_secret");if(null==a||null==b)return null;app.oauthResult=OAuth.create("twitter",{oauth_token:a,oauth_token_secret:b})},updateOathUserInfoComplete:function(a){app.authenticatedHeader();null!=app.activeUser&&null!=app.activeUser.user&&null!=app.activeUser.user.id_str&&null==app.activeUser.privateKey?
(app.hideAllViews(),$("#"+app.STATUS_MESSAGE_VIEW).show(),app.generatePrivateKeyPair(app.generatePassword(),!0,function(){app.updateUIBasedUponOauthResult()})):app.updateUIBasedUponOauthResult()},updateOauthUserInfo:function(){null!=app.oauthResult?app.oauthResult.me().done(function(a){app.activeUser.user=a.raw;app.refreshActiveUserTotal();app.updateOathUserInfoComplete(a)}).fail(function(a){alert("There was an error logging you into Twitter.  Please reload the page and try again.")}):app.updateOathUserInfoComplete()},
updateUIBasedUponOauthResult:function(){null!=app.oauthResult?(app.authenticatedUI(),app.maxId=null,app.updateHomeTimeline()):app.unauthenticatedUI()},dmMaxId:null,getDirectMessages:function(a){$("#directMessagesActionsContainer").empty();$("#directMessagesBreadCrumbContainer").empty();$("#friendName").empty();a||($("#directMessages").empty(),app.dmMaxId=null);var b={count:200,full_text:!0};app.dmMaxId&&a&&(b.max_id=app.dmMaxId);app.overlay();app.oauthResult.get("1.1/direct_messages.json",{data:b}).done(function(a){0<
a.length?(app.processDirectMessagesResponse(a),app.updateDirectMesssagesBreadcrumbs(null)):(app.hideOverlays(),$("#directMessages").html("No direct messages."))}).fail(function(a){app.hideOverlays()})},updateDirectMessagesUI:function(a){app.hideOverlays();$("#getMessagesButton2").remove();$("#directMessages").append(Handlebars.templates["direct-messages-template.hbs"](a));$("#olderDirectMessagesButtonContainer").show()},publicKeyStartRegex:/^\s*-----BEGIN PGP PUBLIC KEY BLOCK-----\s/,publicKeyEndRegex:/\s-----END PGP PUBLIC KEY BLOCK-----\s*$/,
pgpMessageStartRegex:/^\s*-----BEGIN PGP MESSAGE-----/,pgpMessageEndRegex:/\s-----END PGP MESSAGE-----\s*$/,isPublicKey:function(a){return app.publicKeyStartRegex.test(a)&&app.publicKeyEndRegex.test(a)},isPGPMessage:function(a){return app.pgpMessageStartRegex.test(a)&&app.pgpMessageEndRegex.test(a)},timelineContainsKeys:function(a){for(var b in a)if(app.isPublicKey(a[b].seecret))return!0;return!1},timelineContainsEncryptedMessages:function(a){for(var b in a)if(app.isPGPMessage(a[b].seecret))return!0;
return!1},getPublicKeyMessagesFromDMList:function(a){var b=[],c;for(c in a)app.isPublicKey(a[c].seecret)&&b.push(a[c]);return b},savePublicKeys:function(a){for(var b in a){var c=app.activeUser.publicKeys;null==c&&(c={});var d={},e;for(e in a)a[e].sender.id_str!=app.activeUser.user.id&&(d[a[e].sender.id_str]||(d[a[e].sender.id_str]={key:a[e].seecret,screen_name:a[e].sender.screen_name,id_str:a[e].sender.id_str,receiveDate:a[e].created_at}));for(var f in d)c[f]=d[f];app.saveObject("publicKeys-"+app.activeUser.user.id_str,
c);app.activeUser.publicKeys=c}},processDirectMessagesResponse:function(a){1==a.length&&a[0].id_str==app.dmMaxId?($("#directMessages").append(Handlebars.templates["no-more-direct-messages-template.hbs"]()),app.hideOverlays()):(a=app.processDirectMessages(a,app.getUniqueDMSenders),app.timelineContainsKeys(a)&&app.savePublicKeys(app.getPublicKeyMessagesFromDMList(a)),app.timelineContainsEncryptedMessages(a)?(app.markEncryptedDirectMessages(a),app.decryptDirectMessages(a)):app.updateDirectMessagesUI(a))},
markEncryptedDirectMessages:function(a){for(var b in a)this.isPGPMessage(a[b].seecret)&&(a[b].encrypted=!0,a[b].decrypted=!1)},sendPublicKeyMessages:function(a,b){app.postDirectMessages(a,function(){app.trackSentPublicKeys(b)})},trackSentPublicKeys:function(a){var b=app.activeUser.sentPublicKeys;null==b&&(b={});for(var c in a)b[c]=new Date;app.activeUser.sentPublicKeys=b;app.saveObject("sentPublicKeys-"+app.activeUser.user.id_str,b)},passphrase:null,decryptDirectMessages:function(a){var b=openpgp.key.readArmored(app.activeUser.privateKey.armored).keys[0];
app.decryptPrivateKey(b)?app.verifyMessagesDecrypted(a,b):app.updateDirectMessagesUI(a)},verifyMessagesDecrypted:function(a,b){var c=null,d;for(d in a)if(a[d].encrypted&&0==a[d].decrypted){c=d;break}var e=app.activeUser.user;if(null!=c)if(a[c].sender.id_str==e.id)a[c].decrypted=!0,app.verifyMessagesDecrypted(a,b);else{a[d].decrypted=!0;a[d].decryptionSuccessful=!1;a[d].originaltext=a[d].text;try{var f=openpgp.message.readArmored(a[c].seecret),g={privateKey:b,message:f};if(app.activeUser.publicKeys&&
app.activeUser.publicKeys[a[c].sender.id_str]){var l=openpgp.key.readArmored(app.activeUser.publicKeys[a[c].sender.id_str].key);g.publicKeys=l.keys}try{openpgp.decrypt(g).then(function(b){a[d].decryptionSuccessful=!0;a[d].seecret=b.data;b.signatures&&0<b.signatures.length&&b.signatures[0].valid&&(a[d].signed=!0);app.verifyMessagesDecrypted(a,g.privateKey)},function(b){a[d].text=app.generateUndecryptedMessageContent(a[d]);app.verifyMessagesDecrypted(a,g.privateKey)})}catch(k){console.log("try/catch error decrypting: "+
JSON.stringify(k)),a[d].text=app.generateUndecryptedMessageContent(a[d]),app.verifyMessagesDecrypted(a,b)}}catch(k){console.log("major try/catch error decrypting: "+JSON.stringify(k)),a[d].text=app.generateUndecryptedMessageContent(a[d]),app.verifyMessagesDecrypted(a,b)}}else{(c=app.activeUser.dmSenders)||(c={});for(var h in a)a[h].encrypted&&a[h].sender.id_str!=app.activeUser.id&&(c[a[h].sender.id_str]=!0);app.saveObject("dmSenders-"+app.activeUser.user.id_str,c);app.refreshActiveUserDMSenders();
app.updateDirectMessagesUI(a)}},undecryptedMessageContentHandler:null,generateUndecryptedMessageContent:function(a){return Handlebars.templates["undecrypted-message-content-template.hbs"](a)},showPublicKeyManager:function(a,b){app.doScroll=!1;var c={};c.receiver_name=b;c.receiver_id=a;$("#directMessagesActionsContainer").html(Handlebars.templates["public-key-template.hbs"](c))},showWaitingForPublicKeyView:function(a,b){app.doScroll=!1;var c={};c.receiver_name=b;c.receiver_id=a;c.invite_date=moment(app.activeUser.sentPublicKeys[a]).format("MMMM Do YYYY, h:mm:ss a");
$("#directMessagesActionsContainer").html(Handlebars.templates["public-key-pending-template.hbs"](c))},showDirectMessageForm:function(a,b){app.doScroll=!1;var c={receiverId:a,receiverName:b};$("#directMessagesActionsContainer").html(Handlebars.templates["direct-message-template.hbs"](c));app.doScroll=!1},makeKeyOptionsForUser:function(a){var b=app.generatePassword();return{numBits:1024,userIds:[{name:a.name,email:a.screen_name+"@seecretApp.seecret"}],passphrase:b}},generatePassword:function(){for(var a=
"",b=0;50>b;b++){var c=Math.floor(96*Math.random())+31;92==c||34==c||39==c||36==c?b--:a+=String.fromCharCode(c)}return a},validateNewPrivateKey:function(a){if(1>$("#"+a).val().length)return $("#"+a+"Error").html("You must have a passphrase for your key of at least one character"),!1;$("#"+a+"Error").html("");if(confirm("Are you sure?")){var b=$("#"+a).val(),c=1==document.getElementById(a+"Cache").checked;app.hideAllViews();$("#"+app.STATUS_MESSAGE_VIEW).show();app.generatePrivateKeyPair(b,c,function(){$("#"+
a).val("");app.setView(app.DIRECT_MESSAGES_VIEW);confirm("Send your new key to the contacts who have the old one?")&&app.resendPublicKeys();$("#directMessagesActionsContainer").empty()})}},resendPublicKeys:function(){var a=app.activeUser.sentPublicKeys,b=app.activeUser.dmSenders;if(null!=a||null!=b){var c=[],d={},e;for(e in a)d[e]=!0;for(e in b)d[e]=!0;var a=0,f;for(f in d){a++;var b=app.generatePublicKeyMessages(f),g;for(g in b)c.push({receiverId:f,text:b[g]})}0<c.length&&app.sendPublicKeyMessages(c,
d)}},generatePrivateKeyPair:function(a,b,c){var d=app.activeUser.user,e=app.makeKeyOptionsForUser(d);e.passphrase=a;d.id_str||(e.userId=d.id_str);null!=d&&(a=new Date,console.log("start generating key pair : "+a.getSeconds()+":"+a.getMilliseconds()),openpgp.generateKey(e).then(function(a){app.generatePrivateKeyPairSuccess(a,e,b,c)}))},generatePrivateKeyPairSuccess:function(a,b,c,d){var e=new Date;console.log("done generating key pair: "+e.getSeconds()+":"+e.getMilliseconds());c||delete b.passphrase;
c=app.activeUser.user;var e=new Date,f={};f.armored=a.privateKeyArmored;f.dateCreated=e;var g={};g.armored=a.publicKeyArmored;g.dateCreated=e;app.saveObject("keyOptions-"+c.id_str,b);app.saveObject("privateKey-"+c.id_str,f);app.saveObject("publicKey-"+c.id_str,g);app.checkDirectMessageStatus();app.refreshActiveUserTotal();d()},setDirectMessageReceiver:function(a,b){$("#selectedReceiverId").val(a);$("#selectedReceiverName").val(b);var c={};c.name=b;c.id_str=a;var d=app.activeUser.publicKeys,e;for(e in d)d[e].id_str==
a&&(c.publicKey=d[e],c.publicKey.displayDate=(new moment(c.publicKey.receiveDate)).format("MMMM Do YYYY, h:mm:ss a"));$("#friendName").html(Handlebars.templates["direct-message-friend-name.hbs"](c));app.checkDirectMessageStatus();$(".dmMessageDiv").hide();$(".dm_"+a).fadeIn()},updateDirectMesssagesBreadcrumbs:function(a){$("#directMessagesBreadCrumbContainer").html(Handlebars.templates["direct-message-breadcrumb-template.hbs"](a))},initiateDirectMessages:function(a,b){var c=app.generatePublicKeyMessages(a),
d=[],e;for(e in c)d.push({receiverId:a,text:c[e]});b||d.push({text:app.joinMessage,receiverId:a});app.postDirectMessages(d,function(){var b={};b[a]=!0;app.trackSentPublicKeys(b);app.checkDirectMessageStatus()})},joinMessage:"I'm using Seecret to send encrypted direct messages over Twitter. Try it with me! Just go to https://www.seecret.net",prepareDirectMessage:function(a){var b=$("#directMessage").val();app.encryptDirectMessage(b,a)},decryptPrivateKey:function(a){var b=app.activeUser.keyOptions,
c=null;app.passphrase&&(c=app.passphrase);b.passphrase&&(c=b.passphrase);b.passphrase||null!=app.passphrase||(app.passphrase=c=prompt("Enter your passphrase"));return a.decrypt(c)},encryptDirectMessage:function(a,b){var c=app.activeUser.publicKeys,d=null,e;for(e in c)e==b&&(d=c[e].key);d&&(c=openpgp.key.readArmored(d).keys,c={publicKeys:c,data:a},app.activeUser.privateKey&&(d=openpgp.key.readArmored(app.activeUser.privateKey.armored),app.decryptPrivateKey(d.keys[0])&&(c.privateKeys=d.keys)),openpgp.encrypt(c).then(function(a){a=
app.hideAndCompress(a.data);app.seecret_engine.config.RANDOM_COVERTEXTS=!0;app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=1E4;a=app.seecret_engine.chainify(a,covertexts);app.seecret_engine.config.RANDOM_COVERTEXTS=!1;app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=140;a.reverse();for(var c in a)a[c]={receiverId:b,text:a[c]};app.postDirectMessages(a,function(){});$("#directMessage").val("")})["catch"](function(a){console.log("Error generating the messages:"+JSON.stringify(a))}))},postedDirectMessageId:null,
directMessagesToPost:null,directMessageCount:0,postDirectMessages:function(a,b){app.directMessagesToPost=a;app.directMessageCount=0;app.checkDirectMessages(b)},checkDirectMessages:function(a){if(app.directMessagesToPost&&app.directMessageCount<app.directMessagesToPost.length){var b=app.directMessagesToPost[app.directMessageCount].text,c=app.directMessagesToPost[app.directMessageCount].receiverId;app.directMessageCount++;app.postDirectMessage(b,c,a)}else alert("Sent!"),a&&a()},postDirectMessage:function(a,
b,c){app.oauthResult.post("1.1/direct_messages/new.json",{data:{text:a,user_id:b}}).done(function(a){app.checkDirectMessages(c)}).fail(function(a){})},generatePublicKeyMessages:function(a){a=app.activeUser.publicKey;if(null!=a)return a=app.hideAndCompress(a.armored),app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=1E4,chain=app.seecret_engine.chainify(a,["Here's my Seecret key","Now we can start using Seecret to send encrypted messages on Twitter."]),chain.reverse(),app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH=
140,chain},promptDeleteKey:function(){confirm("Are you sure?")&&(app.deleteSavedItem("privateKey-"+app.activeUser.user.id_str),app.deleteSavedItem("publicKey-"+app.activeUser.user.id_str),app.deleteSavedItem("keyOptions-"+app.activeUser.user.id_str),app.activeUser.privateKey=null,app.activeUser.publicKey=null,app.activeUser.keyOptions=null,app.renderPrivateKeySettings(),app.setView(app.SETTINGS_VIEW))},checkDirectMessageStatus:function(){app.doScroll=!1;var a=$("#selectedReceiverId").val(),b=$("#selectedReceiverName").val();
if(a)if(null==app.activeUser.privateKey)app.showPrivateKeyManager();else{var c=app.activeUser.publicKeys,d=app.activeUser.sentPublicKeys;null==d||null==d[a]||null!=c&&c[a]?null==c||null!=c&&!c[a]?app.showPublicKeyManager(a,b):app.showDirectMessageForm(a,b):app.showWaitingForPublicKeyView(a,b);app.doScroll=!0}},maxId:null,lastId:null,homeTimeline:!0,userTimelineId:null,updateUserTimeline:function(a,b){b&&(app.maxId=null);app.userTimelineId=a;app.homeTimeline=!1;app.updatingTimeline=!0;var c={data:{}};
c.data.count=200;c.data.screen_name=a;c.data.include_rts=!1;null!=app.maxId?c.data.max_id=app.maxId:$("#status-list").empty();app.hideOverlays();app.getUserTimeline(c,app.handleTimelineResponse)},getTimeline:function(a,b){app.oauthResult.get("1.1/statuses/home_timeline.json",a).done(function(a){b(a);app.hideOverlays()}).fail(app.handleGetTimelineError)},getUserTimeline:function(a,b){app.oauthResult.get("1.1/statuses/user_timeline.json",a).done(function(a){b(a);app.hideOverlays()}).fail(app.handleGetTimelineError)},
handleTimelineResponse:function(a){0<a.length?1==a.length&&a[0].id_str==app.maxId?$("#status-list").append(Handlebars.templates["no-more-timeline-message-template.hbs"]()):app.processTimelineResponse(a):app.handleEmptyTimelineResponse(a)},handleGetTimelineError:function(a){429==a.status?alert("Twitter rate limit exceeded.  You must wait 15 minutes to make more requests from this app."):404==a.status?alert("Twitter says that screen name does not exist."):alert("There was an error retrieving the timeline.");
console.log("Error:"+JSON.stringify(a));app.hideOverlays()},handleEmptyTimelineResponse:function(a){app.hideOverlays()},processTimelineResponse:function(a){app.addFollowerTagToTweets(a,app.processTimelineWithFollowerInfo)},addFollowerTagToTweets:function(a,b){var c={},d;for(d in a)c[a[d].user.id_str]=a[d].user.id_str;d=[];for(var e in c)d.push(e);c={data:{}};c.data.user_id=d.join();app.oauthResult.get("1.1/friendships/lookup.json",c).done(function(c){var d={},e;for(e in c)0<=c[e].connections.indexOf("followed_by")&&
(d[c[e].id_str]=!0);for(var h in a)d[a[h].user.id_str]&&(a[h].follower=!0);b(a)}).fail(function(c){b(a)})},unhideAndDecompressTimelineSeecrets:function(a,b){var c=[],d;for(d in a)if(a[d].seecret_envelope){var e=a[d].seecret_envelope,f=app.seecret_engine.getSeecretFromEnvelope(e),e=app.seecret_engine.getContentTypeFromEnvelope(e),f=app.seecret_engine.unhide(f,e);if(e==app.seecret_engine.config.CONTENT_TYPES.NUMBERS_ARRAY)try{f=seecret_compression.decompress(f),a[d].seecret=f}catch(g){console.log("error decompressing a seecret message: "+
JSON.stringify(g)),a[d].seecret="Could not decompress the Seecret",a[d].seecret_error=g}else a[d].seecret=f;c.push(a[d])}else b&&!app.seecret_engine.hasSeecretContent(a[d].text)&&c.push(a[d]);return c},getEarliestIncompleteChainStartId:function(a,b){for(var c in b)app.getFirstIncompleteChainStart(a,b[c])},getEarliestIncompleteDMChainStartId:function(a,b){for(var c in b)app.getFirstIncompleteDMChainStart(a,b[c])},getFirstIncompleteChainStart:function(a,b){var c=0,d;for(d in a)a[d].user.id_str==b&&
app.seecret_engine.hasSeecretContent(a[d].text)&&(app.seecret_engine.isEnvelopeStart(a[d].text)&&(c=d),app.seecret_engine.isEnvelopeEnd(a[d].text)&&(c=0));return c},getFirstIncompleteDMChainStart:function(a,b){var c=0,d;for(d in a)a[d].sender.id_str==b&&app.seecret_engine.hasSeecretContent(a[d].text)&&(app.seecret_engine.isEnvelopeStart(a[d].text)&&(c=d),app.seecret_engine.isEnvelopeEnd(a[d].text)&&(c=0));return c},processDirectMessages:function(a,b){var c=b(a),d=app.getSeecretMessageIndexesBySender(a,
c);a=app.dechainifyDirectMessages(a,d);app.dmMaxId=app.lastProcessedStatusId=a[a.length-1].id_str;c=app.getEarliestIncompleteDMChainStartId(a,c);0<c&&(app.dmMaxId=a[c].id_str);a=app.unhideAndDecompressTimelineSeecrets(a,!0);return a=app.imgUrlsToHttps(a,"sender")},processTimelineMessages:function(a,b){var c=b(a),d=app.getMessageIndexes(a,c,app.tweetSenderGetter);a=app.dechainifyTweets(a,d);app.maxId=app.lastProcessedStatusId=a[a.length-1].id_str;c=app.getEarliestIncompleteChainStartId(a,c);0<c&&(app.maxId=
a[c].id_str);a=app.unhideAndDecompressTimelineSeecrets(a,!document.getElementById("showOnlySeecrets").checked);return a=app.imgUrlsToHttps(a,"user")},httpsReplaceRegex:/^http:/,imgUrlsToHttps:function(a,b){for(var c in a)a[c][b]&&a[c][b].profile_image_url&&(a[c][b].profile_image_url=a[c][b].profile_image_url.replace(app.httpsReplaceRegex,"https:"));return a},processTimelineWithFollowerInfo:function(a){a=app.processTimelineMessages(a,app.getUniqueTweeters);0<a.length?$("#status-list").append(Handlebars.templates["status-template.hbs"](a)):
$("#showOnlySeecrets")&&$("#status-list").append(Handlebars.templates["no-seecrets-in-timeline-segment-template.hbs"]());$(".basicTweet").fadeIn();app.updatingTimeline=!1;app.userTimelineId?app.renderUserTimelineHeader(app.userTimelineId):$("#timelineName").html("")},renderUserTimelineHeader:function(a){$("#timelineName").html("for "+a+" &nbsp;&nbsp;&nbsp;<a href='javascript:app.initTimeline();app.updateHomeTimeline()'>Back to my timeline</a>")},dechainifyTweets:function(a,b){for(var c in b)if(0<
b[c].length){var d=0,e;for(e in b[c]){var f=app.seecret_engine.dechainifyWithCovertexts(a,{chainSegmentMatcher:function(a){return a&&a.text&&"string"==typeof a.text&&a.user&&a.user.id_str==c?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder,ordinal:d});f&&""!=f.seecret&&(a[b[c][e]].seecret_envelope=f.seecret,a[b[c][e]].covertexts=f.covertexts);d++}}return a},dechainifyDirectMessages:function(a,b){for(var c in b)if(0<b[c].length){var d=0,e;for(e in b[c]){var f=app.seecret_engine.dechainifyWithCovertexts(a,
{chainSegmentMatcher:function(a){return a&&a.text&&"string"==typeof a.text&&a.sender&&a.sender.id_str==c?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder,ordinal:d});f&&""!=f.seecret&&(a[b[c][e]].seecret_envelope=f.seecret,a[b[c][e]].covertexts=f.covertexts);d++}}return a},chainSegmentContentFinder:function(a){return a.text},tweetSenderGetter:function(a){return a.user?a.user.id_str:null},dmSenderGetter:function(a){return a.user?a.user.id_str:null},getMessageIndexes:function(a,b,c){var d=
{},e;for(e in b)d[e]=app.seecret_engine.getOrdinalIndexes(a,{chainSegmentMatcher:function(a){return c(a)==b[e]?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder});return d},getSeecretMessageIndexesByUser:function(a,b){var c={},d;for(d in b)c[d]=app.seecret_engine.getOrdinalIndexes(a,{chainSegmentMatcher:function(a){return a&&a.text&&"string"==typeof a.text&&a.user&&a.user.id_str==b[d]?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder});return c},getSeecretMessageIndexesBySender:function(a,
b){var c={},d;for(d in b)c[d]=app.seecret_engine.getOrdinalIndexes(a,{chainSegmentMatcher:function(a){return a&&a.text&&"string"==typeof a.text&&a.sender&&a.sender.id_str==b[d]?a:null},chainSegmentContentFinder:this.chainSegmentContentFinder});return c},getUniqueTweeters:function(a){return app.getUniqueInstancesFromList(a,app.getTweeterId)},getUniqueDMSenders:function(a){return app.getUniqueInstancesFromList(a,app.getDMSenderId)},getTweeterId:function(a){return a.user.id_str},getDMSenderId:function(a){return a.sender.id_str},
getUniqueInstancesFromList:function(a,b){var c={},d;for(d in a){var e=b(a[d]);c[e]=e}return c},generateTimelinePostVals:function(){var a={data:{}};a.data.count=200;null!=app.maxId&&(a.data.max_id=app.maxId);return a},initTimeline:function(){app.maxId=null;app.homeTimeline=!0;app.userTimelineId=null;app.updateHomeTimeline()},updateHomeTimeline:function(a){a&&(app.maxId=null);app.homeTimeline=!0;$("#timelineName").empty();app.updatingTimeline=!0;a=app.generateTimelinePostVals();a.data.max_id||($("#status-list").empty(),
app.lastProcessedStatusId=null);app.overlay();app.getTimeline(a,app.handleTimelineResponse)},postCompleteCount:0,postCompleteTarget:0,prepareUpdateMessage:function(){var a=$("#textarea-statusUpdate").val(),a=app.hideAndCompress(a),b=null;app.useAutogeneratedScaffolding()||(b=app.getScaffolds());a=app.seecret_engine.chainify(a,b);a.reverse();return a},updateStatus:function(){var a=this.prepareUpdateMessage();this.postChain(a)},postChain:function(a){this.currentMessageChain=a;this.chainCount=0;this.postChainItem()},
postChainItem:function(){this.chainCount<this.currentMessageChain.length?app.oauthResult.post("1.1/statuses/update.json",{data:{status:this.currentMessageChain[this.chainCount++]}}).done(function(a){setTimeout(function(){app.postChainItem()},50)}).fail(function(a){}):($("#status-list").empty(),$("#scaffoldingWarningContainer").empty(),$("#scaffoldingStatus").empty(),$("#textarea-statusUpdate").val(""),$("#textarea-statusUpdate").val(""),$("#scaffoldsContainer").html(Handlebars.templates["scaffolds-template.hbs"]()),
$("#scaffoldingContainer > div > div > input").val(""),app.maxId=null,this.currentMessageChain=[],this.chainCount=0,app.updateHomeTimeline(),app.setView(app.TIMELINE_VIEW))},authenticatedUI:function(){app.authenticatedHeader();app.authenticatedMenu();app.setView(app.TIMELINE_VIEW)},unauthenticatedUI:function(){$("#status-list").empty();$("#userLabel").empty();$("#userProfileImg").hide();$("#directMessages").empty();$("#publicKeys").empty();$("#directMessagesActionsContainer").val("");$("#textarea-statusUpdate").val("");
$("#importPrivateKeyText").val("");$("#importPrivateKeyPassphrase").val("");$("#privateKeyTextarea").val("");$("#privateKeyPassphrase").val("");$("#privateKeyCopyarea").empty();$("#publicKeysDisplayArea").empty();app.unauthenticatedHeader();app.hideAllViews();$("#privateMessageButton").hide();$("#timelineButton").hide();app.unauthenticatedMenu();app.setView(app.ABOUT_VIEW)},authenticatedMenu:function(){$("#privateMessageButton").show();$("#timelineButton").show();$("#settingsButton").show();$("#logoutButton").show();
$("#hashesButton").show();$("#publicKeysButton").show();$("#aboutButton").show()},unauthenticatedMenu:function(){$("#privateMessageButton").hide();$("#timelineButton").hide();$("#settingsButton").hide();$("#logoutButton").hide();$("#publicKeysButton").hide()},authenticatedHeader:function(){$("#loginContainer").html(Handlebars.templates["authenticated-header-template.hbs"](app.activeUser.user))},unauthenticatedHeader:function(){$("#loginContainer").html(Handlebars.templates["unauthenticated-header-template.hbs"]())},
hideAllViews:function(){$("#timeline").hide();$("#statusMessage").hide();$("#privateMessages").hide();$("#settings").hide();$("#publicKeys").hide();$("#about").hide();$("#hashes").hide()},setMenuState:function(a){$.each($(".menuLink"),function(a,c){$(this).css("background","");$(this).css("color","")});$("#"+a).css("background","#e3e3e3");$("#"+a).css("color","#333");app.openClosePanel("close")},setView:function(a){app.doScroll=!1;app.hideAllViews();$("#"+a).fadeIn(function(){app.doScroll=!0}).css("display",
"block");app.setMenuState(a+"Button")},renderPublicKeys:function(){var a=app.activeUser.publicKeys,b=[],c=0,d;for(d in a)a[d].displayDate=moment(a[d].receiveDate).format("MMMM Do YYYY, h:mm:ss a"),b.push(a[d]),c++;0<c?(a=Handlebars.templates["public-keys-template.hbs"]({keys:b}),$("#publicKeysDisplayArea").html(a)):$("#publicKeysDisplayArea").html("No public keys")},copySenderPublicKeyToClipboard:function(a){var b=app.activeUser.publicKeys;b[a]&&(executeCopy(b[a].key),alert(b[a].screen_name+"'s key has been copied to your clipboard"))},
copyContentsToClipboard:function(a){executeCopy($("#"+a).html())},showPrivateKeyManager:function(){app.doScroll=!1;$("#directMessagesActionsContainer").html(Handlebars.templates["private-key-template.hbs"]());$("#directMessagesActionsContainer").show()},openClosePanel:function(a){"open"==a?$("#left-panel").css("left",0):$("#left-panel").css("left","-14em")},processScaffoldField:function(a){a=$("#scaffold"+a);val=a.val();for(var b=val.replace(/\s{2,}/g," ");" "==b.substr(0,1);)b=b.substr(1);b=b.substr(0,
100);b!=val&&a.val(b)},useAutogeneratedScaffolding:function(){return!1},hideAndCompress:function(a){var b=app.seecret_engine.hide(a,app.seecret_engine.config.CONTENT_TYPES.PLAIN),b=app.seecret_engine.envelope(b,app.seecret_engine.config.CONTENT_TYPES.PLAIN);a=seecret_compression.compress(a);a=app.seecret_engine.hide(a,app.seecret_engine.config.CONTENT_TYPES.NUMBERS_ARRAY);a=app.seecret_engine.envelope(a,app.seecret_engine.config.CONTENT_TYPES.NUMBERS_ARRAY);return b.length>a.length?a:b},processScaffolding:function(){var a=
$("#textarea-statusUpdate").val();if(!app.useAutogeneratedScaffolding()){var b=!1,a=app.hideAndCompress(a),c=app.getScaffolds(),d=0,e=0;if(1==c.length)if(2<=c[0].trim().length&&c[0].trim().length+a.length<app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH)b=!0,d=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH-a.length-c[0].trim().length;else{if(2>c[0].trim().length){app.makeUpdateFormPending();return}e=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH-(c[0].trim().length+a.length);e*=-1}else{var f=
scaffoldLength=0;for(each in c)2<=c[each].trim().length&&(scaffoldLength+=c[each].trim().length,f++);scaffoldLength+a.length<app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH*f?(b=!0,d=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH*f-(scaffoldLength+a.length)):(e=app.seecret_engine.config.MAX_CHAIN_SEGMENT_LENGTH*f-(scaffoldLength+a.length),e*=-1)}b?app.makeUpdateFormReady(d):app.makeUpdateFormNotReady(e)}},newVisibleMessageField:function(){var a=app.getScaffolds();app.addScaffoldField(a.length);
app.processScaffolding()},addScaffoldField:function(a,b){var c={scaffoldId:a,val:b,scaffoldCount:a+1};$("#scaffoldsContainer").append(Handlebars.templates["scaffold-template.hbs"](c))},makeUpdateFormReady:function(a){$("#submitButtonContainer").show();var b={};b.availableCharacters=a;$("#scaffoldingStatus").html(Handlebars.templates["scaffold-status-good-template.hbs"](b))},makeUpdateFormNotReady:function(a){$("#submitButtonContainer").hide();var b={};b.spillover=a;$("#scaffoldingStatus").html(Handlebars.templates["scaffold-status-spillover-template.hbs"](b))},
makeUpdateFormPending:function(){$("#submitButtonContainer").hide();$("#scaffoldingStatus").html(Handlebars.templates["scaffold-status-incomplete-template.hbs"]())},removeScaffold:function(a){var b=app.getScaffolds(),c=[],d;for(d in b)d!=a&&c.push(b[d]);app.renderScaffolds(c);app.processScaffolding()},renderScaffolds:function(a){$("#scaffoldsContainer").html("");for(var b=0,c=0;c<a.length;c++)app.addScaffoldField(b++,a[c]);$("#scaffoldRemover0").remove()},getScaffolds:function(){for(var a=[],b=document.getElementById("scaffold0");b;)a.push(b.value.trim()),
b=document.getElementById("scaffold"+a.length);return a},toggleScaffolds:function(){document.getElementById("scaffoldingOption").checked?($("#scaffoldingStatus").html(""),$("#scaffoldsContainer").html(""),$("#scaffoldingWarningContainer").hide(),$("#scaffoldingContainer").hide(),$("#submitButtonContainer").show()):($("#scaffoldingStatus").html(""),$("#scaffoldsContainer").html(""),$("#scaffoldingContainer").show(),$("#scaffoldingWarningContainer").html(""),$("#submitButtonContainer").hide(),app.addScaffoldField(0),
app.processScaffolding())},getScaffoldTotal:function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].trim().length;return b},showCopyPrivateKey:function(a){"block"==$("#privateKeyCopyarea").css("display")?($(a).html("Show"),$("#privateKeyCopyarea").hide(),$("#privateKeyCopyarea").html("")):($(a).html("Hide"),app.renderPrivateKeySettings())},toggleDeleteSettings:function(a){"block"==$("#deleteKeyForm").css("display")?($(a).html("Show"),$("#deleteKeyForm").hide()):($(a).html("Hide"),$("#deleteKeyForm").show())},
renderPrivateKeySettings:function(){var a=app.activeUser.publicKey,b=app.activeUser.keyOptions,c={};c.privateKey=app.activeUser.privateKey;c.privateKey.dateCreatedDisplay=(new moment(c.privateKey.dateCreated)).format("MMMM Do YYYY, h:mm:ss a");c.publicKey=a;c.keyOptions=b;a=Handlebars.templates["user-keys-template.hbs"](c);$("#privateKeyCopyarea").html(a);$("#privateKeyCopyarea").fadeIn()},showPublicKeys:function(a){"block"==$("#publicKeysDisplayArea").css("display")?($(a).html("Show"),$("#publicKeysDisplayArea").hide()):
($(a).html("Hide"),app.renderPublicKeys(),$("#publicKeysDisplayArea").fadeIn())},showImportPrivateKey:function(a){"block"==$("#importForm").css("display")?($(a).html("Show"),$("#importForm").hide()):($(a).html("Hide"),$("#importForm").show())},showGeneratePrivateKey:function(a){"block"==$("#generateForm").css("display")?($(a).html("Show"),$("#generateForm").hide()):($(a).html("Hide"),$("#generateForm").show())},saveObject:function(a,b){localStorage[a]=JSON.stringify(b)},getObject:function(a){return app.getLocalObject(a)},
getLocalObject:function(a){return localStorage[a]?JSON.parse(localStorage[a]):null},saveLocalObject:function(a,b){localStorage[a]=JSON.stringify(b)},deleteSavedItem:function(a){delete localStorage[a]},privateKeyUpdateStatus:{},importPrivateKey:function(){var a=app.activeUser.user,b=$("#importPrivateKeyText").val(),c=new Date,d=openpgp.key.readArmored(b);if(!d||!d.keys||1>d.keys.length)alert("The key is invalid");else{var e=openpgp.key.readArmored(b).keys[0],f=$("#importPrivateKeyPassphrase").val();
e.decrypt(f)?(f=$("#importPrivateKeyPassphrase").val(),$("#importPrivateKeyText").val(""),$("#importPrivateKeyPassphrase").val(""),d=app.makeKeyOptionsForUser(a),d.passphrase=f,b={armored:b,dateCreated:c},c={armored:e.toPublic().armor(),dateCreated:c},app.activeUser.privateKey=b,app.activeUser.publicKey=c,app.activeUser.keyOptions=d,app.saveObject("privateKey-"+a.id_str,b),app.saveObject("publicKey-"+a.id_str,c),app.saveObject("keyOptions-"+a.id_str,d),app.activeUser.privateKey=b,app.activeUser.publicKey=
c,app.activeUser.keyOptions=d,app.resendPublicKeys(),app.renderPrivateKeySettings(),alert("Successfully imported the private key.")):alert("Could not decrypt the key with the passphrase you entered.  Please try again")}},deleteSavedPassphrase:function(){if(confirm("Are you sure?")){var a=app.activeUser.user,b=app.activeUser.keyOptions;b.passphrase="";app.activeUser.keyOptions=b;app.saveObject("keyOptions-"+a.id_str,b)}app.renderPrivateKeySettings()},changePassphrase:function(){var a=prompt("Enter new passphrase");
if(null!=a){var b=prompt("Enter it again");null!=b&&(a==b?(alert("Changing your passphrase to "+b+"\n we urge you to delete it from this device once you've got it memorized or saved elsewhere."),app.setNewPassphraseOnPrivateKey(a)):alert("Your new passphrase did not match, please try again"))}app.renderPrivateKeySettings()},setNewPassphraseOnPrivateKey:function(a){var b=app.activeUser.user,c=app.activeUser.keyOptions,d=openpgp.key.readArmored(app.activeUser.privateKey.armored);if(app.decryptPrivateKey(d.keys[0])){d.keys[0].primaryKey.encrypt(a);
d.keys[0].subKeys&&0<d.keys[0].subKeys.length&&d.keys[0].subKeys[0]&&d.keys[0].subKeys[0].subKey.encrypt(a);var e={};e.dateCreated=new Date;e.armored=d.keys[0].armor();var f={};f.dateCreated=new Date;f.armored=d.keys[0].toPublic().armor();c.passphrase=a;app.saveObject("publicKey-"+b.id_str,f);app.saveObject("privateKey-"+b.id_str,e);app.saveObject("keyOptions-"+b.id_str,c);app.activeUser.publicKey=f;app.activeUser.privateKey=e;app.activeUser.keyOptions=c}else alert("Old passphrase was incorrect.  Please try again");
app.renderPrivateKeySettings()},privateKeyTest:function(){var a=openpgp.key.readArmored(app.activeUser.privateKey.armored).keys[0];alert(app.decryptPrivateKey(a))},overlay:function(a){a||(a="overlay");$("#"+a).css("display","block")},hideOverlays:function(){$("#overlay").css("display","none");$("#static-overlay").css("display","none")}};
$(document).ready(function(){openpgp.config.show_comment=!1;openpgp.config.show_version=!1;app.initialize();app.seecret_engine=new SEECRET_ENGINE;$(window).scroll(function(){if(app.doScroll){var a=$(window).scrollTop(),b=$(window).height(),c=$(document).height();a+b==c&&("block"!=document.getElementById("timeline").style.display||app.updatingTimeline?"block"!=document.getElementById("privateMessages").style.display||app.updatingDirectMessages||app.getDirectMessages(!0):app.homeTimeline?app.updateHomeTimeline():
app.updateUserTimeline(app.userTimelineId))}});$("#textarea-statusUpdate").keyup(function(a){app.processScaffolding()});$("#textarea-statusUpdate").change(function(a){app.processScaffolding()});$("#scaffoldingEntryContainer0").keyup(function(a){app.processScaffoldField(0);app.processScaffolding()});$("#hashesContent").html(Handlebars.templates["hashes-template.hbs"](seecret_hashes));$("#updateStatusForm").submit(function(a){a.preventDefault();app.updateStatus()})});
Handlebars.registerHelper("tweetShortDate",function(a){a=moment(a,"dd MMM DD HH:mm:ss ZZ YYYY","en").twitter();a.match(/\//)||(a+=" ago");return a});function executeCopy(a){var b=document.createElement("div");b.contentEditable=!0;document.body.appendChild(b);b.innerHTML=a.replace(/\n/g,"<br/>");b.unselectable="off";b.focus();document.execCommand("SelectAll");document.execCommand("Copy",!1,null);document.body.removeChild(b)};
